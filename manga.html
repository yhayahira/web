<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>yh manga</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <header>
        <a href="index.html" class="site-title">
            <h1>green record</h1>
        </a>
        <nav>
            <ul>
                <li><a href="manga.html">画</a></li>
                <li><a href="note.html">文</a></li>
                <li><a href="profile.html">人</a></li>
            </ul>
        </nav>
        <h1>画</h1>
    </header>

    <main>
        <section>
            <div class="manga" data-manga-id="a">
                <h3>「まぼろしは光線のような」</h3>
                <p>「緑とナイフと王国たち」収録　関西コミティア69にて発表、販売　2024年</p>
            </div>
            <div class="manga" data-manga-id="b">
                <h3>「魔術師の犬の大冒険」</h3>
                <p>「緑とナイフと王国たち」収録　関西コミティア69にて発表、販売　2024年</p>
            </div>
            <div class="manga" data-manga-id="c">
                <h3>「地獄の口、楽園の門。」</h3>
                <p>「地獄の口、楽園の門。」収録　コミティア149にて発表、販売　2024年</p>
            </div>
            <div class="manga" data-manga-id="d">
                <h3>公開予定「レイクサイド・ハイウェイ」</h3>
                <p>「レイクサイド・ハイウェイ」収録　コミティア150にて発表、販売　2024年</p>
            </div>
        </section>
    </main>

    <footer>
        <p>© yamamoto hayahira All rights reserved.</p>
    </footer>

    <!-- ポップアップ表示のコンテナ -->
    <div class="popup" id="popup">
        <button class="navigation-button prev-button" id="prevButton">▶</button>
        <img src="" alt="表示画像" id="popupImage">
        <button class="navigation-button next-button" id="nextButton">◀</button>
        <button class="close-popup" id="closePopup">×</button>
    </div>

<script>
    const mangaTitles = document.querySelectorAll('.manga h3');
    const popup = document.getElementById('popup');
    const popupImage = document.getElementById('popupImage');
    const nextButton = document.getElementById('nextButton');
    const prevButton = document.getElementById('prevButton');
    const closePopup = document.getElementById('closePopup');
    let currentImages = [];
    let currentIndex = 0;

    mangaTitles.forEach(title => {
        title.addEventListener('click', () => {
            const mangaId = title.parentElement.dataset.mangaId;

            const images = {
                a: [ "images/maboroshi_008.jpg", "images/maboroshi_009.jpg", "images/maboroshi_010.jpg", /* ... */ ],
                b: [ "images/majutu1.jpg", "images/majutu2.jpg", /* ... */ ],
                c: [ "images/jigoku_001.jpg", "images/jigoku_002.jpg", /* ... */ ],
                d: [ "images/dog_image1.png", "images/dog_image2.png" ]
            };

            currentImages = images[mangaId] || [];
            if (currentImages.length > 0) {
                currentIndex = 0;
                // まず1ページ目を即表示
                showPopup(currentImages[currentIndex]);

                // 残りを裏でプリロード（100ms遅らせてUI優先）
                setTimeout(() => {
                    preloadImages(currentImages.slice(1));
                }, 100);
            } else {
                console.log("画像が見つかりませんでした");
            }
        });
    });

    function preloadImages(imageArray) {
        imageArray.forEach(src => {
            const img = new Image();
            img.src = src;
        });
    }

    function showPopup(src) {
        popupImage.src = src;
        popup.style.display = 'flex';
        updateNavigationButtons();
    }

    function updateNavigationButtons() {
        prevButton.style.display = (currentIndex === 0) ? 'none' : 'flex';
        nextButton.style.display = 'flex';
    }

    prevButton.addEventListener('click', () => {
        if (currentIndex > 0) {
            currentIndex--;
            popupImage.src = currentImages[currentIndex];
            updateNavigationButtons();
        }
    });

    nextButton.addEventListener('click', () => {
        if (currentIndex < currentImages.length - 1) {
            currentIndex++;
            popupImage.src = currentImages[currentIndex];
        } else {
            popup.style.display = 'none';
        }
        updateNavigationButtons();
    });

    closePopup.addEventListener('click', () => {
        popup.style.display = 'none';
    });

    let startX = 0;
    let endX = 0;

    popup.addEventListener('touchstart', (event) => {
        startX = event.touches[0].clientX;
    });

    popup.addEventListener('touchend', (event) => {
        endX = event.changedTouches[0].clientX;
        if (endX - startX > 50) {
            nextButton.click();
        } else if (startX - endX > 50) {
            prevButton.click();
        }
    });
</script>
</body>
</html>

